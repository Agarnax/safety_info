<!--
Simple single-file web app: Fire / Equipment QR Pages
Filename: index.html (or fire-qr-app.html)

What it does:
- Create pages with: title, description, photo
- Each page gets a unique URL (hash-based) so you can print a QR code that points to it
- Pages are stored in browser localStorage (zero backend)
- QR code images are generated by Google Chart API (no extra JS libraries required)
- Minimal dependencies — single static HTML file. Deploy to GitHub Pages or Netlify for free.

How to use:
1. Open this file in a browser (double-click). The admin UI appears where you can add items.
2. Create a new page: give a title, description and upload a photo. Click "Save".
3. In the list, click "Open" to view the public-facing page. The QR code shown is the QR for the public link.
4. Click "Download QR" to save the QR image (PNG). Print it and stick it to the equipment.

Deployment (quick):
Option A — GitHub Pages (recommended, free):
  a. Create a new GitHub repository (public or private).
  b. Add this file as index.html in the repo root and push to GitHub.
  c. In repo Settings -> Pages, choose branch 'main' (or 'gh-pages') and root (/) as the folder. Save.
  d. You'll get a URL like https://<your-username>.github.io/<repo-name>/ — open it and the app runs.

Option B — Netlify Drop (super simple):
  a. Go to https://app.netlify.com/drop and drag-drop this index.html file.
  b. Netlify will give you a public URL instantly.

Notes & Limitations:
- Data is stored per browser (localStorage). If you want multiple admins or permanent storage, you'll need a backend (I can help if you want that later).
- The QR generator uses Google Chart API for convenience. If you prefer fully offline generation, I can swap in a tiny JS library instead.
- Image files are stored as base64 in localStorage — keep images modest (e.g., <= 300 KB) to avoid exceeding storage limits.

Feel free to ask for a hosted example or to convert this to a tiny backend + DB.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QR Pages — Simple Equipment Info</title>
  <style>
    :root{--bg:#f7f8fb;--card:#fff;--muted:#6b7280;--accent:#0b5cff}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); margin:0; color:#0f172a}
    .wrap{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    h1{margin:0;font-size:22px}
    p.lead{margin:4px 0 14px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:20px}
    .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    label{display:block;font-size:13px;margin-top:8px;color:var(--muted)}
    input[type=text], textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #e6e9ef;margin-top:6px;font-size:14px}
    textarea{min-height:100px;resize:vertical}
    button{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:0;font-weight:600;cursor:pointer}
    .small{font-size:13px;padding:6px 8px}
    .list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;border:1px dashed #e9eef7}
    .item img{width:54px;height:40px;object-fit:cover;border-radius:6px}
    .item .meta{flex:1}
    .muted{color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px}
    .public-view{max-width:760px;margin:0 auto}
    .public-card img{max-width:100%;border-radius:8px}
    .center{display:flex;justify-content:center}
    a.link{color:var(--accent);text-decoration:none;font-weight:600}
    .qr{width:260px;height:260px}
    .top-actions{display:flex;gap:8px;margin-left:auto}
    @media(max-width:900px){.grid{grid-template-columns:1fr;}.top-actions{margin-left:0}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>QR Pages — Equipment Info</h1>
        <p class="lead">Create short info pages (title, description, photo). Each page has a QR code you can print and stick on equipment.</p>
      </div>
      <div class="top-actions">
        <button id="btn-import" class="small">Import JSON</button>
        <button id="btn-export" class="small">Export JSON</button>
        <button id="btn-clear" class="small">Clear All</button>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <h3 style="margin-top:0">Create / Edit Page</h3>
        <form id="form">
          <input type="hidden" id="page-id">
          <label>Title</label>
          <input id="title" placeholder="e.g., Fire Extinguisher (A-10)" required>
          <label>Description</label>
          <textarea id="desc" placeholder="Short description and location"></textarea>

          <label>Photo (optional)</label>
          <input id="photo" type="file" accept="image/*">
          <div id="preview-wrap" style="margin-top:8px"></div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button type="submit">Save</button>
            <button type="button" id="btn-reset" class="small">Reset</button>
          </div>
        </form>

        <hr style="margin:12px 0">
        <h4 style="margin:8px 0">Pages</h4>
        <div id="list" class="list"></div>
      </div>

      <div id="right" class="card public-view">
        <div id="public-root">
          <p class="muted">Open a page from the list to see the public view (or scan the QR from another device).</p>
        </div>
      </div>
    </div>
  </div>

<script>
// Simple storage and UI logic
const STORAGE_KEY = 'qr-pages-v1'
const form = document.getElementById('form')
const listEl = document.getElementById('list')
const publicRoot = document.getElementById('public-root')
const titleInput = document.getElementById('title')
const descInput = document.getElementById('desc')
const photoInput = document.getElementById('photo')
const previewWrap = document.getElementById('preview-wrap')
const pageIdInput = document.getElementById('page-id')

let pages = loadPages()
renderList()

photoInput.addEventListener('change', ()=>{
  const f = photoInput.files[0]
  if(!f) { previewWrap.innerHTML=''; return }
  const reader = new FileReader()
  reader.onload = e=>{
    previewWrap.innerHTML = `<img src="${e.target.result}" style="max-width:100%;border-radius:8px">`
  }
  reader.readAsDataURL(f)
})

form.addEventListener('submit', async (ev)=>{
  ev.preventDefault()
  let id = pageIdInput.value || generateId()
  let imageData = null
  if(photoInput.files && photoInput.files[0]){
    imageData = await toDataURLAsync(photoInput.files[0])
  } else {
    // If editing and no new image provided, preserve existing image
    const existing = pages.find(p=>p.id===id)
    if(existing) imageData = existing.image || null
  }
  const page = {id, title: titleInput.value.trim(), desc: descInput.value.trim(), image: imageData, updated: Date.now()}
  pages = pages.filter(p=>p.id!==id)
  pages.unshift(page)
  savePages()
  renderList()
  form.reset()
  previewWrap.innerHTML=''
  pageIdInput.value = ''
})

function renderList(){
  listEl.innerHTML = ''
  if(!pages.length){ listEl.innerHTML = '<div class="muted">No pages yet.</div>'; return }
  for(const p of pages){
    const item = document.createElement('div'); item.className='item'
    const img = document.createElement('img'); img.src = p.image || placeholderDataURL(p.title)
    const meta = document.createElement('div'); meta.className='meta'
    meta.innerHTML = `<div style="font-weight:700">${escapeHtml(p.title)}</div><div class="muted">${escapeHtml(p.desc)}</div>`
    const actions = document.createElement('div'); actions.className='actions'
    const btnOpen = document.createElement('button'); btnOpen.className='small'; btnOpen.textContent='Open'; btnOpen.onclick = ()=>openPublic(p.id)
    const btnEdit = document.createElement('button'); btnEdit.className='small'; btnEdit.textContent='Edit'; btnEdit.onclick = ()=>editItem(p.id)
    const btnQR = document.createElement('button'); btnQR.className='small'; btnQR.textContent='QR'; btnQR.onclick = ()=>showQrModal(p.id)
    const btnDel = document.createElement('button'); btnDel.className='small'; btnDel.textContent='Delete'; btnDel.onclick = ()=>{ if(confirm('Delete this page?')){ pages = pages.filter(x=>x.id!==p.id); savePages(); renderList(); publicRoot.innerHTML=''; }}
    actions.appendChild(btnOpen); actions.appendChild(btnEdit); actions.appendChild(btnQR); actions.appendChild(btnDel)
    item.appendChild(img); item.appendChild(meta); item.appendChild(actions)
    listEl.appendChild(item)
  }
}

function openPublic(id){
  const p = pages.find(x=>x.id===id)
  if(!p) return alert('Not found')
  // Render the public view in right pane and update location hash so it's shareable
  window.location.hash = `#/page/${id}`
  renderPublic(p)
}

function renderPublic(p){
  const origin = location.origin + location.pathname
  const pageUrl = origin + '#/page/' + p.id
  const qrSrc = makeQrUrl(pageUrl)
  publicRoot.innerHTML = `
    <div class="public-card">
      <h2 style="margin-bottom:6px">${escapeHtml(p.title)}</h2>
      <p class="muted">${escapeHtml(p.desc)}</p>
      <div style="margin:12px 0">${p.image ? `<img alt="${escapeHtml(p.title)}" src="${p.image}">` : ''}</div>
      <div style="display:flex;gap:12px;align-items:center">
        <div>
          <img class="qr" src="${qrSrc}" alt="QR code">
        </div>
        <div>
          <div style="margin-bottom:8px">Public link:</div>
          <div style="word-break:break-all;background:#f1f5ff;padding:8px;border-radius:6px">${pageUrl}</div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <a class="link" href="${qrSrc}" download="qr-${p.id}.png">Download QR</a>
            <button class="small" onclick="window.open('${pageUrl}','_blank')">Open in new tab</button>
          </div>
        </div>
      </div>
    </div>
  `
}

function editItem(id){
  const p = pages.find(x=>x.id===id)
  if(!p) return
  pageIdInput.value = p.id
  titleInput.value = p.title
  descInput.value = p.desc
  previewWrap.innerHTML = p.image ? `<img src="${p.image}" style="max-width:100%;border-radius:8px">` : ''
  // scroll to top
  window.scrollTo({top:0,behavior:'smooth'})
}

function showQrModal(id){
  const p = pages.find(x=>x.id===id)
  if(!p) return
  renderPublic(p)
}

function savePages(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(pages)) }
function loadPages(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY))||[] }catch(e){return []} }
function generateId(){ return Math.random().toString(36).slice(2,10) }
function toDataURLAsync(file){ return new Promise((res,rej)=>{ const reader = new FileReader(); reader.onload=e=>res(e.target.result); reader.onerror=rej; reader.readAsDataURL(file) }) }

function makeQrUrl(text){ const size = 300; return 'https://chart.googleapis.com/chart?cht=qr&chs='+size+'x'+size+'&chl='+encodeURIComponent(text) }

function placeholderDataURL(text){ // small SVG placeholder
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200'><rect width='100%' height='100%' fill='#eef2ff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#4b5563' font-family='Arial' font-size='20'>${escapeHtml(text||'No image')}</text></svg>`
  return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg)
}

function escapeHtml(s){ if(!s) return '' ; return s.replace(/[&<>\"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]) }

// --- Import / Export / Clear ---
const btnExport = document.getElementById('btn-export')
const btnImport = document.getElementById('btn-import')
const btnClear = document.getElementById('btn-clear')

btnExport.addEventListener('click', ()=>{
  const data = JSON.stringify(pages, null, 2)
  const blob = new Blob([data], {type:'application/json'})
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a'); a.href = url; a.download = 'qr-pages-export.json'; a.click(); URL.revokeObjectURL(url)
})

btnImport.addEventListener('click', ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='application/json'
  input.onchange = e=>{
    const f = e.target.files[0]; if(!f) return
    const r = new FileReader(); r.onload = ev=>{ try{ const imported = JSON.parse(ev.target.result); if(Array.isArray(imported)){ pages = imported.concat(pages); savePages(); renderList(); alert('Imported '+imported.length+' pages'); } else alert('Invalid file'); } catch(err){ alert('Could not parse file') } }
    r.readAsText(f)
  }
  input.click()
})

btnClear.addEventListener('click', ()=>{ if(confirm('Clear ALL pages from this browser? This cannot be undone.')){ pages=[]; savePages(); renderList(); publicRoot.innerHTML=''; }} )

// --- Handle direct links/hash ---
function handleHash(){
  const h = location.hash
  if(!h) return
  const m = h.match(/^#\/page\/(.+)$/)
  if(m){ const id = m[1]; const p = pages.find(x=>x.id===id); if(p) renderPublic(p); else publicRoot.innerHTML = '<div class="muted">Page not found.</div>' }
}
window.addEventListener('hashchange', handleHash)
handleHash()
</script>
</body>
</html>
